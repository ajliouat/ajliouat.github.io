<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Vault</title>
  <style>
    :root {
      --bg: #ffffff;
      --surface: #ffffff;
      --border: #e5e7eb;
      --text: #0f172a;
      --muted: #6b7280;
      --accent: #2563eb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: radial-gradient(circle at top, #f9fafb 0, #ffffff 52%, #f3f4f6 100%);
      color: var(--text);
    }

    a { color: inherit; text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page-wrap {
      max-width: 800px;
      margin: 0 auto;
      padding: 3rem 1.5rem 6rem;
    }

    .page-header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .page-header h1 {
      font-size: 1.6rem;
      letter-spacing: -0.01em;
      margin: 0 0 0.4rem;
    }

    .page-header p {
      color: var(--muted);
      font-size: 0.85rem;
      margin: 0;
    }

    /* â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .auth-gate {
      max-width: 420px;
      margin: 4rem auto;
      text-align: center;
    }

    .auth-gate .lock-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .auth-gate h2 {
      font-size: 1.1rem;
      margin: 0 0 0.5rem;
    }

    .auth-gate p {
      color: var(--muted);
      font-size: 0.82rem;
      margin: 0 0 1.5rem;
      line-height: 1.5;
    }

    .auth-form {
      display: flex;
      gap: 0.5rem;
    }

    .auth-form input {
      flex: 1;
      padding: 0.65rem 0.9rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.82rem;
      font-family: "SF Mono", "Fira Code", monospace;
      background: var(--surface);
      color: var(--text);
      outline: none;
      transition: border-color 0.15s;
    }

    .auth-form input:focus {
      border-color: var(--accent);
    }

    .auth-form button, .btn {
      padding: 0.65rem 1.2rem;
      border: 1px solid var(--accent);
      border-radius: 8px;
      background: var(--accent);
      color: #fff;
      font-size: 0.82rem;
      cursor: pointer;
      white-space: nowrap;
      transition: opacity 0.15s;
    }

    .auth-form button:hover, .btn:hover {
      opacity: 0.85;
    }

    .auth-error {
      color: #dc2626;
      font-size: 0.78rem;
      margin-top: 0.75rem;
      display: none;
    }

    /* â”€â”€ Vault UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .vault-ui { display: none; }

    .vault-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.82rem;
      color: var(--muted);
      flex-wrap: wrap;
    }

    .breadcrumb a {
      color: var(--accent);
      cursor: pointer;
    }

    .breadcrumb span {
      color: var(--muted);
    }

    .vault-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-sm {
      padding: 0.4rem 0.8rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--surface);
      color: var(--text);
      font-size: 0.75rem;
      cursor: pointer;
      transition: background 0.15s;
    }

    .btn-sm:hover {
      background: #f3f4f6;
    }

    .btn-danger {
      border-color: #fca5a5;
      color: #dc2626;
    }

    .btn-danger:hover {
      background: #fef2f2;
    }

    /* â”€â”€ File List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .file-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .file-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.8rem 1rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 0.4rem;
      cursor: pointer;
      transition: background 0.12s, border-color 0.12s;
    }

    .file-item:hover {
      background: #f8fafc;
      border-color: var(--accent);
    }

    .file-icon {
      font-size: 1.1rem;
      width: 1.5rem;
      text-align: center;
      flex-shrink: 0;
    }

    .file-info {
      flex: 1;
      min-width: 0;
    }

    .file-name {
      font-size: 0.85rem;
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .file-meta {
      font-size: 0.72rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .file-actions {
      display: flex;
      gap: 0.4rem;
      flex-shrink: 0;
    }

    /* â”€â”€ Document Viewer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .doc-viewer {
      display: none;
    }

    .doc-viewer-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      gap: 0.75rem;
    }

    .doc-viewer-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .doc-content {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      background: var(--surface);
      font-size: 0.85rem;
      line-height: 1.7;
      overflow-x: auto;
    }

    .doc-content h1 { font-size: 1.35rem; margin: 0 0 0.75rem; }
    .doc-content h2 { font-size: 1.1rem; margin: 1.5rem 0 0.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.3rem; }
    .doc-content h3 { font-size: 0.95rem; margin: 1.2rem 0 0.4rem; }
    .doc-content p { margin: 0.5rem 0; }
    .doc-content ul, .doc-content ol { padding-left: 1.5rem; }
    .doc-content li { margin: 0.25rem 0; }
    .doc-content code {
      font-family: "SF Mono", "Fira Code", monospace;
      background: #f1f5f9;
      padding: 0.15em 0.35em;
      border-radius: 4px;
      font-size: 0.83em;
    }
    .doc-content pre {
      background: #020617;
      color: #e5e7eb;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.8rem;
      line-height: 1.6;
    }
    .doc-content pre code {
      background: none;
      padding: 0;
      color: inherit;
    }
    .doc-content table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
      margin: 0.75rem 0;
    }
    .doc-content th, .doc-content td {
      border: 1px solid var(--border);
      padding: 0.5rem 0.75rem;
      text-align: left;
    }
    .doc-content th {
      background: #f8fafc;
      font-weight: 600;
    }
    .doc-content blockquote {
      border-left: 3px solid var(--accent);
      margin: 0.75rem 0;
      padding: 0.5rem 1rem;
      color: var(--muted);
      background: #f8fafc;
      border-radius: 0 6px 6px 0;
    }
    .doc-content hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 1.5rem 0;
    }

    /* â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .spinner {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-overlay {
      text-align: center;
      padding: 3rem;
      color: var(--muted);
      font-size: 0.82rem;
    }

    /* â”€â”€ Section Badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.7rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 0.3rem 0.75rem 0.3rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(37, 99, 235, 0.25);
      background: rgba(37, 99, 235, 0.04);
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .section-badge::before {
      content: "";
      display: inline-block;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #93c5fd, #2563eb);
    }

    /* â”€â”€ Dark mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    html[data-theme='dark'] {
      --bg: #020617;
      --surface: #0f172a;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #38bdf8;
    }

    html[data-theme='dark'] body {
      background: #020617;
    }

    html[data-theme='dark'] .file-item:hover {
      background: #1e293b;
    }

    html[data-theme='dark'] .doc-content code {
      background: #1e293b;
    }

    html[data-theme='dark'] .doc-content th {
      background: #1e293b;
    }

    html[data-theme='dark'] .doc-content blockquote {
      background: #0f172a;
    }

    html[data-theme='dark'] .btn-sm:hover {
      background: #1e293b;
    }

    html[data-theme='dark'] .btn-danger:hover {
      background: #1c1917;
    }

    html[data-theme='dark'] .auth-form input {
      background: #0f172a;
      color: #e5e7eb;
      border-color: #374151;
    }

    /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .site-footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.72rem;
      color: var(--muted);
      border-top: 1px solid var(--border);
      margin-top: 4rem;
    }
  </style>
</head>
<body>

<!-- NAV -->
<div id="site-nav-root"></div>

<!-- PAGE -->
<div class="page-wrap">

  <div class="page-header">
    <span class="section-badge">Private Vault</span>
    <h1>Documents</h1>
    <p>Secure access to private documents via GitHub API</p>
  </div>

  <!-- AUTH GATE -->
  <div id="auth-gate" class="auth-gate">
    <div class="lock-icon">ğŸ”’</div>
    <h2>Authentication Required</h2>
    <p>
      Enter your GitHub Personal Access Token with <code>repo</code> scope.
      The token is stored only in your browser's session and is never saved to disk.
    </p>
    <div class="auth-form">
      <input type="password" id="token-input" placeholder="ghp_..." autocomplete="off">
      <button onclick="authenticate()">Unlock</button>
    </div>
    <div id="auth-error" class="auth-error"></div>
  </div>

  <!-- VAULT UI  -->
  <div id="vault-ui" class="vault-ui">
    <div class="vault-toolbar">
      <div id="breadcrumb" class="breadcrumb"></div>
      <div class="vault-actions">
        <button class="btn-sm" onclick="refreshView()">â†» Refresh</button>
        <button class="btn-sm btn-danger" onclick="lockVault()">ğŸ”’ Lock</button>
      </div>
    </div>
    <div id="file-list-container"></div>
  </div>

  <!-- DOC VIEWER -->
  <div id="doc-viewer" class="doc-viewer">
    <div class="doc-viewer-header">
      <span id="doc-title" class="doc-viewer-title"></span>
      <div class="vault-actions">
        <button class="btn-sm" onclick="downloadCurrent()">â¬‡ Download</button>
        <button class="btn-sm" onclick="backToList()">â† Back</button>
      </div>
    </div>
    <div id="doc-content" class="doc-content"></div>
  </div>

</div>

<!-- FOOTER -->
<footer class="site-footer">
  Â© 2026 Abdeljalil Jliouat â€” Private & Confidential
</footer>

<!-- SCRIPTS -->
<script src="/nav.js"></script>
<script>
(function () {
  const REPO = 'ajliouat/private-vault';
  const API  = 'https://api.github.com';

  let currentPath = '';
  let currentFile = null;
  let currentContent = '';

  // â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function getToken() {
    return sessionStorage.getItem('vault_token') || '';
  }

  function setToken(t) {
    sessionStorage.setItem('vault_token', t);
  }

  function clearToken() {
    sessionStorage.removeItem('vault_token');
  }

  window.authenticate = async function () {
    const input = document.getElementById('token-input');
    const token = input.value.trim();
    if (!token) return;

    try {
      const res = await fetch(`${API}/repos/${REPO}`, {
        headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' }
      });

      if (!res.ok) throw new Error('Invalid token or no access');

      setToken(token);
      input.value = '';
      showVault();
      loadDir('');
    } catch (e) {
      const errEl = document.getElementById('auth-error');
      errEl.textContent = e.message;
      errEl.style.display = 'block';
    }
  };

  window.lockVault = function () {
    clearToken();
    currentPath = '';
    currentFile = null;
    document.getElementById('vault-ui').style.display = 'none';
    document.getElementById('doc-viewer').style.display = 'none';
    document.getElementById('auth-gate').style.display = 'block';
  };

  // â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function apiGet(url) {
    const res = await fetch(url, {
      headers: {
        'Authorization': `token ${getToken()}`,
        'Accept': 'application/vnd.github.v3+json'
      }
    });
    if (res.status === 401) { lockVault(); throw new Error('Session expired'); }
    if (!res.ok) throw new Error(`API error: ${res.status}`);
    return res.json();
  }

  async function apiGetRaw(url) {
    const res = await fetch(url, {
      headers: {
        'Authorization': `token ${getToken()}`,
        'Accept': 'application/vnd.github.v3.raw'
      }
    });
    if (!res.ok) throw new Error(`API error: ${res.status}`);
    return res.text();
  }

  // â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function showVault() {
    document.getElementById('auth-gate').style.display = 'none';
    document.getElementById('vault-ui').style.display = 'block';
    document.getElementById('doc-viewer').style.display = 'none';
  }

  function showDoc() {
    document.getElementById('vault-ui').style.display = 'none';
    document.getElementById('doc-viewer').style.display = 'block';
  }

  window.backToList = function () {
    showVault();
  };

  // â”€â”€ Breadcrumb â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function renderBreadcrumb(path) {
    const bc = document.getElementById('breadcrumb');
    const parts = path ? path.split('/') : [];
    let html = `<a onclick="loadDir('')">ğŸ“ vault</a>`;

    let accumulated = '';
    for (const part of parts) {
      accumulated += (accumulated ? '/' : '') + part;
      const p = accumulated;
      html += ` <span>/</span> <a onclick="loadDir('${p}')">${part}</a>`;
    }

    bc.innerHTML = html;
  }

  // â”€â”€ Directory Listing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function loadDir(path) {
    currentPath = path;
    currentFile = null;
    showVault();
    renderBreadcrumb(path);

    const container = document.getElementById('file-list-container');
    container.innerHTML = '<div class="loading-overlay"><div class="spinner"></div><br>Loadingâ€¦</div>';

    try {
      const endpoint = path
        ? `${API}/repos/${REPO}/contents/${path}`
        : `${API}/repos/${REPO}/contents`;

      const items = await apiGet(endpoint);

      if (!Array.isArray(items)) {
        container.innerHTML = '<p style="color:var(--muted);text-align:center">Empty or not a directory</p>';
        return;
      }

      // Sort: directories first, then files, alphabetical
      items.sort((a, b) => {
        if (a.type === 'dir' && b.type !== 'dir') return -1;
        if (a.type !== 'dir' && b.type === 'dir') return 1;
        return a.name.localeCompare(b.name);
      });

      // Filter out .git and README.md at root level
      const filtered = items.filter(i => i.name !== '.git');

      let html = '<ul class="file-list">';

      // Parent directory link
      if (path) {
        const parentPath = path.includes('/') ? path.substring(0, path.lastIndexOf('/')) : '';
        html += `
          <li class="file-item" onclick="loadDir('${parentPath}')">
            <span class="file-icon">â¬†</span>
            <div class="file-info">
              <div class="file-name">..</div>
              <div class="file-meta">Parent directory</div>
            </div>
          </li>`;
      }

      for (const item of filtered) {
        const icon = item.type === 'dir' ? 'ğŸ“' : getFileIcon(item.name);
        const size = item.size ? formatSize(item.size) : '';
        const action = item.type === 'dir'
          ? `onclick="loadDir('${item.path}')"`
          : `onclick="openFile('${item.path}', '${item.name}')"`;

        html += `
          <li class="file-item" ${action}>
            <span class="file-icon">${icon}</span>
            <div class="file-info">
              <div class="file-name">${item.name}</div>
              <div class="file-meta">${item.type === 'dir' ? 'Folder' : size}</div>
            </div>
            ${item.type !== 'dir' ? `
            <div class="file-actions">
              <button class="btn-sm" onclick="event.stopPropagation(); downloadFile('${item.path}', '${item.name}')">â¬‡</button>
            </div>` : ''}
          </li>`;
      }

      html += '</ul>';
      container.innerHTML = html;

    } catch (e) {
      container.innerHTML = `<p style="color:#dc2626;text-align:center">${e.message}</p>`;
    }
  }

  window.loadDir = loadDir;

  // â”€â”€ File Viewer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  window.openFile = async function (path, name) {
    currentFile = { path, name };
    showDoc();

    document.getElementById('doc-title').textContent = name;
    document.getElementById('doc-content').innerHTML = '<div class="loading-overlay"><div class="spinner"></div><br>Loadingâ€¦</div>';

    try {
      const raw = await apiGetRaw(`${API}/repos/${REPO}/contents/${path}`);
      currentContent = raw;

      if (name.endsWith('.md')) {
        document.getElementById('doc-content').innerHTML = renderMarkdown(raw);
      } else if (name.endsWith('.json')) {
        document.getElementById('doc-content').innerHTML = `<pre><code>${escapeHtml(raw)}</code></pre>`;
      } else {
        document.getElementById('doc-content').innerHTML = `<pre>${escapeHtml(raw)}</pre>`;
      }
    } catch (e) {
      document.getElementById('doc-content').innerHTML = `<p style="color:#dc2626">${e.message}</p>`;
    }
  };

  // â”€â”€ Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  window.downloadFile = async function (path, name) {
    try {
      const raw = await apiGetRaw(`${API}/repos/${REPO}/contents/${path}`);
      triggerDownload(raw, name);
    } catch (e) {
      alert('Download failed: ' + e.message);
    }
  };

  window.downloadCurrent = function () {
    if (currentFile && currentContent) {
      triggerDownload(currentContent, currentFile.name);
    }
  };

  function triggerDownload(content, filename) {
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href     = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // â”€â”€ Refresh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  window.refreshView = function () {
    loadDir(currentPath);
  };

  // â”€â”€ Markdown Renderer (lightweight) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function renderMarkdown(md) {
    let html = md;

    // Escape HTML first
    html = escapeHtml(html);

    // Headings
    html = html.replace(/^######\s+(.+)$/gm, '<h6>$1</h6>');
    html = html.replace(/^#####\s+(.+)$/gm, '<h5>$1</h5>');
    html = html.replace(/^####\s+(.+)$/gm, '<h4>$1</h4>');
    html = html.replace(/^###\s+(.+)$/gm, '<h3>$1</h3>');
    html = html.replace(/^##\s+(.+)$/gm, '<h2>$1</h2>');
    html = html.replace(/^#\s+(.+)$/gm, '<h1>$1</h1>');

    // Horizontal rules
    html = html.replace(/^---$/gm, '<hr>');

    // Bold & italic
    html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
    html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');

    // Inline code
    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

    // Code blocks
    html = html.replace(/```(\w*)\n([\s\S]*?)```/g, function (_, lang, code) {
      return '<pre><code>' + code + '</code></pre>';
    });

    // Blockquotes
    html = html.replace(/^&gt;\s+(.+)$/gm, '<blockquote>$1</blockquote>');

    // Tables
    html = html.replace(/^(\|.+\|)\n(\|[\s:|-]+\|)\n((?:\|.+\|\n?)*)/gm, function (_, header, sep, body) {
      const ths = header.split('|').filter(c => c.trim()).map(c => `<th>${c.trim()}</th>`).join('');
      const rows = body.trim().split('\n').map(row => {
        const tds = row.split('|').filter(c => c.trim()).map(c => `<td>${c.trim()}</td>`).join('');
        return `<tr>${tds}</tr>`;
      }).join('');
      return `<table><thead><tr>${ths}</tr></thead><tbody>${rows}</tbody></table>`;
    });

    // Unordered lists
    html = html.replace(/^[-*]\s+(.+)$/gm, '<li>$1</li>');
    html = html.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');

    // Ordered lists
    html = html.replace(/^\d+\.\s+(.+)$/gm, '<li>$1</li>');

    // Checkboxes
    html = html.replace(/\[ \]/g, 'â˜');
    html = html.replace(/\[x\]/g, 'â˜‘');

    // Paragraphs (lines not already wrapped)
    html = html.replace(/^(?!<[hupoltb]|<\/|<li|<hr|<blockquote)(.+)$/gm, '<p>$1</p>');

    // Clean up double newlines
    html = html.replace(/\n{2,}/g, '\n');

    return html;
  }

  function escapeHtml(text) {
    return text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;');
  }

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function getFileIcon(name) {
    if (name.endsWith('.md')) return 'ğŸ“„';
    if (name.endsWith('.json')) return 'ğŸ“‹';
    if (name.endsWith('.pdf')) return 'ğŸ“•';
    if (name.endsWith('.csv')) return 'ğŸ“Š';
    if (name.endsWith('.png') || name.endsWith('.jpg')) return 'ğŸ–¼';
    return 'ğŸ“„';
  }

  function formatSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
  }

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  // Allow Enter key to submit
  document.getElementById('token-input').addEventListener('keydown', function (e) {
    if (e.key === 'Enter') authenticate();
  });

  // Check if already authenticated
  if (getToken()) {
    showVault();
    loadDir('');
  }
})();
</script>

</body>
</html>
